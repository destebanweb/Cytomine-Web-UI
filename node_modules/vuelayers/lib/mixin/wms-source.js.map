{"version":3,"file":"wms-source.js","sources":["src/mixin/wms-source.js"],"sourcesContent":["import { WMS_VERSION } from '../ol-ext'\nimport { hasSource, hasView } from '../util/assert'\nimport { reduce } from '../util/minilo'\n\nconst cleanExtParams = params => reduce(params, (params, value, key) => {\n  const filterKeys = [\n    'LAYERS',\n    'VERSION',\n    'STYLES',\n    'FORMAT',\n    'TRANSPARENT',\n    'BGCOLOR',\n    'TIME',\n  ]\n\n  key = key.toUpperCase()\n  if (filterKeys.includes(key)) {\n    return params\n  }\n\n  params[key] = value\n\n  return params\n}, {})\n\nconst props = {\n  /**\n   * Extra WMS request parameters\n   */\n  extParams: Object,\n  layers: {\n    type: String,\n    required: true,\n  },\n  styles: String, // WMS Request styles\n  version: {\n    type: String,\n    default: WMS_VERSION,\n  },\n  transparent: {\n    type: Boolean,\n    default: true,\n  },\n  format: {\n    type: String,\n    default: 'image/png',\n  },\n  bgColor: String,\n  time: String,\n}\n\nconst computed = {\n  cleanExtParams () {\n    return this.extParams ? cleanExtParams(this.extParams) : undefined\n  },\n  allParams () {\n    return {\n      ...this.cleanExtParams,\n      LAYERS: this.layers,\n      STYLES: this.styles,\n      VERSION: this.version,\n      FORMAT: this.format,\n      TRANSPARENT: this.transparent,\n      BGCOLOR: this.bgColor,\n      TIME: this.time,\n    }\n  },\n}\n\nconst methods = {\n  /**\n   * @param {number[]} coordinate\n   * @param {number} [resolution]\n   * @param {string} [projection]\n   * @param {Object} [params] GetFeatureInfo params. `info_format` at least should be provided.\n   *                          If `query_layers` is not provided then the layers specified in the `layers` prop will be used.\n   *                          `version` should not be specified here (value from `version` prop will be used).\n   * @return {string|undefined}\n   */\n  getFeatureInfoUrl (\n    coordinate,\n    resolution,\n    projection,\n    params = {},\n  ) {\n    hasView(this)\n    hasSource(this)\n\n    resolution || (resolution = this.$view.getResolution())\n    projection || (projection = this.projection)\n    params = { ...this.allParams, ...params }\n\n    return this.$source.getGetFeatureInfoUrl(\n      coordinate,\n      resolution,\n      projection,\n      params,\n    )\n  },\n}\n\nconst watch = {\n  layers (LAYERS) {\n    this.$source && this.$source.updateParams({ LAYERS })\n  },\n  version (VERSION) {\n    this.$source && this.$source.updateParams({ VERSION })\n  },\n  styles (STYLES) {\n    this.$source && this.$source.updateParams({ STYLES })\n  },\n  transparent (TRANSPARENT) {\n    this.$source && this.$source.updateParams({ TRANSPARENT })\n  },\n  time (TIME) {\n    this.$source && this.$source.updateParams({ TIME })\n  },\n  bgColor (BGCOLOR) {\n    this.$source && this.$source.updateParams({ BGCOLOR })\n  },\n  extParams (value) {\n    this.$source && this.$source.updateParams(value ? cleanExtParams(value) : undefined)\n  },\n}\n\nexport default {\n  props,\n  computed,\n  methods,\n  watch,\n}\n"],"names":["cleanExtParams","params","reduce","value","key","filterKeys","toUpperCase","includes","props","extParams","Object","layers","type","String","required","styles","version","default","WMS_VERSION","transparent","Boolean","format","bgColor","time","computed","undefined","allParams","LAYERS","STYLES","VERSION","FORMAT","TRANSPARENT","BGCOLOR","TIME","methods","getFeatureInfoUrl","coordinate","resolution","projection","hasView","hasSource","$view","getResolution","$source","getGetFeatureInfoUrl","watch","updateParams"],"mappings":"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"}