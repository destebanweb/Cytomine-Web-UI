{"version":3,"file":"source.js","sources":["src/mixin/source.js"],"sourcesContent":["import { isFunction } from '../util/minilo'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport cmp from './ol-virt-cmp'\nimport useMapCmp from './use-map-cmp'\n\nconst props = {\n  attributions: [String, Array],\n  logo: String,\n  projection: String,\n  wrapX: {\n    type: Boolean,\n    default: true,\n  },\n}\n\nconst methods = {\n  /**\n   * @return {Source|Promise<Source>}\n   * @protected\n   */\n  createOlObject () {\n    return this.createSource()\n  },\n  /**\n   * @return {Source|Promise<Source>}\n   * @protected\n   * @abstract\n   */\n  createSource () {\n    throw new Error('Not implemented method')\n  },\n  /**\n   * @return {Promise}\n   * @protected\n   */\n  init () {\n    return this::cmp.methods.init()\n  },\n  /**\n   * @return {void|Promise<void>}\n   * @protected\n   */\n  deinit () {\n    return this::cmp.methods.deinit()\n  },\n  /**\n   * @return {Object}\n   * @protected\n   */\n  getServices () {\n    const vm = this\n\n    return mergeDescriptors(this::cmp.methods.getServices(), {\n      get source () { return vm.$source },\n    })\n  },\n  /**\n   * @return {void}\n   * @protected\n   */\n  mount () {\n    this.$sourceContainer && this.$sourceContainer.setSource(this)\n    this.subscribeAll()\n  },\n  /**\n   * @return {void}\n   * @protected\n   */\n  unmount () {\n    this.unsubscribeAll()\n    this.$sourceContainer && this.$sourceContainer.setSource(undefined)\n  },\n  /**\n   * @return {Promise<void>}\n   */\n  refresh () {\n    if (this.$source && !isFunction(this.$source.clear)) {\n      return this::cmp.methods.refresh()\n    }\n\n    return new Promise(resolve => {\n      let done = () => {\n        ++this.rev\n        resolve()\n      }\n      if (this.$source) {\n        this.$source.once('change', done)\n        this.$source.clear()\n      } else {\n        done()\n      }\n    })\n  },\n}\n\nconst watch = {\n  attributions (value) {\n    this.$source && this.$source.setAttributions(value)\n  },\n}\n\nexport default {\n  mixins: [cmp, useMapCmp],\n  props,\n  methods,\n  watch,\n  stubVNode: {\n    empty () {\n      return this.$options.name\n    },\n  },\n  created () {\n    Object.defineProperties(this, {\n      /**\n       * @type {Source|undefined}\n       */\n      $source: {\n        enumerable: true,\n        get: () => this.$olObject,\n      },\n      $map: {\n        enumerable: true,\n        get: () => this.$services && this.$services.map,\n      },\n      $view: {\n        enumerable: true,\n        get: () => this.$services && this.$services.view,\n      },\n      $sourceContainer: {\n        enumerable: true,\n        get: () => this.$services && this.$services.sourceContainer,\n      },\n    })\n  },\n}\n"],"names":["props","attributions","String","Array","logo","projection","wrapX","type","Boolean","default","methods","createOlObject","createSource","Error","init","cmp","deinit","getServices","vm","mergeDescriptors","source","$source","mount","$sourceContainer","setSource","subscribeAll","unmount","unsubscribeAll","undefined","refresh","isFunction","clear","resolve","done","rev","once","watch","value","setAttributions","mixins","useMapCmp","stubVNode","empty","$options","name","created","enumerable","get","$olObject","$map","$services","map","$view","view","sourceContainer"],"mappings":"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"}