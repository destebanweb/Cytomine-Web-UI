{"version":3,"file":"collection.js","sources":["src/ol-ext/collection.js"],"sourcesContent":["import { forEach } from '../util/minilo'\n\n/**\n * Wraps OpenLayers collection to provide indexed access to elements.\n */\nexport class IndexedCollectionAdapter {\n  /**\n   * @param {Collection} collection\n   * @param {function} getElementKey\n   */\n  constructor (collection, getElementKey) {\n    /**\n     * @type {Collection}\n     * @private\n     */\n    this._adaptee = collection\n    /**\n     * @type {Function}\n     * @private\n     */\n    this._getElementKey = getElementKey\n    /**\n     * @type {Object<mixed, number>}\n     * @private\n     */\n    this._index = Object.create(null)\n\n    this._adaptee.forEach(element => this._addToIndex(this._getElementKey(element), element))\n  }\n\n  /**\n   * @return {Collection}\n   */\n  get adaptee () {\n    return this._adaptee\n  }\n\n  get elements () {\n    return this._adaptee.getArray()\n  }\n\n  /**\n   * @param {function} iteratee\n   */\n  forEach (iteratee) {\n    forEach(this.elements, iteratee)\n  }\n\n  /**\n   * @param {*} element\n   */\n  add (element) {\n    let key = this._getElementKey(element)\n\n    if (key != null) {\n      this._adaptee.push(element)\n      this._index[key] = element\n    }\n  }\n\n  /**\n   * @param {*} element\n   */\n  remove (element) {\n    if (this._adaptee.remove(element)) {\n      this._removeFromIndex(this._getElementKey(element))\n    }\n  }\n\n  /**\n   * @param {*} element\n   * @return {boolean}\n   */\n  has (element) {\n    return !!this.findByKey(this._getElementKey(element))\n  }\n\n  /**\n   * @return {void}\n   */\n  clear () {\n    this._adaptee.clear()\n    this._resetIndex()\n  }\n\n  /**\n   * @param {*} key\n   * @return {*|undefined}\n   */\n  findByKey (key) {\n    return key && this._index[key]\n  }\n\n  /**\n   * @param {function} sorter\n   */\n  sort (sorter) {\n    this.elements.sort(sorter)\n  }\n\n  /**\n   * @private\n   */\n  _resetIndex () {\n    this._index = Object.create(null)\n  }\n\n  /**\n   * @param {string} key\n   * @param {*} element\n   * @private\n   */\n  _addToIndex (key, element) {\n    if (key == null) {\n      return false\n    }\n\n    this._index[key] = element\n    element.on('propertychange', this._handleElementChange, this)\n\n    return true\n  }\n\n  /**\n   * @param {string} key\n   * @private\n   */\n  _removeFromIndex (key) {\n    let element = this.findByKey(key)\n\n    if (element) {\n      element.un('propertychange', this._handleElementChange, this)\n      delete this._index[key]\n    }\n\n    return !!element\n  }\n\n  /**\n   * Updates index\n   * @param {*} target\n   * @private\n   */\n  _handleElementChange ({ target }) {\n    let key = this._getElementKey(target)\n    // remove by old key\n    if (this.findByKey(key) !== target) {\n      for (let k in this._index) {\n        if (this._index[k] === target) {\n          this._removeFromIndex(k)\n          break\n        }\n      }\n    }\n\n    this._addToIndex(key, target)\n  }\n}\n\n/**\n * Wraps vector source to provide collection like API.\n */\nexport class SourceCollectionAdapter {\n  /**\n   * @param {Vector} source\n   */\n  constructor (source) {\n    /**\n     * @type {Vector}\n     * @private\n     */\n    this._adaptee = source\n  }\n\n  /**\n   * @return {Vector}\n   */\n  get adaptee () {\n    return this._adaptee\n  }\n\n  /**\n   * @return {Array<Feature>}\n   */\n  get elements () {\n    return this._adaptee.getFeatures()\n  }\n\n  /**\n   * @param {function} iteratee\n   */\n  forEach (iteratee) {\n    this.elements.forEach(iteratee)\n  }\n\n  /**\n   * @param {Feature} feature\n   */\n  add (feature) {\n    this._adaptee.addFeature(feature)\n  }\n\n  /**\n   * @param {Feature} feature\n   */\n  remove (feature) {\n    this._adaptee.removeFeature(feature)\n  }\n\n  /**\n   * @param {Feature} feature\n   * @return {boolean}\n   */\n  has (feature) {\n    return !!this.findByKey(feature.getId())\n  }\n\n  /**\n   * @return {void}\n   */\n  clear () {\n    this._adaptee.clear()\n  }\n\n  /**\n   * @param {*} key\n   * @return {Feature|undefined}\n   */\n  findByKey (key) {\n    return this._adaptee.getFeatureById(key)\n  }\n\n  /**\n   * @param {function} sorter\n   */\n  sort (sorter) {\n    throw new Error('Not supported')\n  }\n}\n"],"names":["IndexedCollectionAdapter","collection","getElementKey","_adaptee","_getElementKey","_index","forEach","element","_addToIndex","iteratee","elements","key","push","remove","_removeFromIndex","findByKey","clear","_resetIndex","sorter","sort","on","_handleElementChange","un","target","k","getArray","SourceCollectionAdapter","source","feature","addFeature","removeFeature","getId","getFeatureById","Error","getFeatures"],"mappings":"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"}