{"version":3,"file":"index.js","sources":["src/component/graticule/graticule.vue?rollup-plugin-vue=script.js","src/component/graticule/graticule.vue","src/component/graticule/index.js"],"sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n\nimport Vue from 'vue'\nimport Graticule from 'ol/Graticule'\nimport { throttleTime } from 'rxjs/operators'\nimport { observableFromOlEvent } from '../../rx-ext'\nimport { olCmp, useMapCmp, projTransforms } from '../../mixin'\nimport { hasGraticule, hasMap } from '../../util/assert'\nimport { firstEl, map } from '../../util/minilo'\nimport mergeDescriptors from '../../util/multi-merge-descriptors'\nimport { makeWatchers } from '../../util/vue-helpers'\n\nconst props = {\n  maxLines: {\n    type: Number,\n    default: 100,\n  },\n  targetSize: {\n    type: Number,\n    default: 100,\n  },\n  showLabels: {\n    type: Boolean,\n    default: false,\n  },\n  lonLabelFormatter: Function,\n  latLabelFormatter: Function,\n  lonLabelPosition: {\n    type: Number,\n    default: 0,\n  },\n  latLabelPosition: {\n    type: Number,\n    default: 1,\n  },\n  intervals: {\n    type: Array,\n    default: () => [90, 45, 30, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1, 0.05, 0.01, 0.005, 0.002, 0.001],\n  },\n}\n\nconst computed = {\n  meridians () {\n    if (this.$graticule && this.rev) {\n      return map(this.getMeridians(), meridian => this.lineToDataProj(meridian.getCoordinates()))\n    }\n\n    return []\n  },\n  parallels () {\n    if (this.$graticule && this.rev) {\n      return map(this.getParallels(), parallel => this.lineToDataProj(parallel.getCoordinates()))\n    }\n\n    return []\n  },\n}\n\nconst methods = {\n  createOlObject () {\n    return new Graticule({\n      maxLines: this.maxLines,\n      targetSize: this.targetSize,\n      showLabels: this.showLabels,\n      strokeStyle: this._strokeStyle,\n      lonLabelFormatter: this.lonLabelFormatter,\n      latLabelFormatter: this.latLabelFormatter,\n      lonLabelPosition: this.lonLabelPosition,\n      latLabelPosition: this.latLabelPosition,\n      lonLabelStyle: this._lonLabelStyle,\n      latLabelStyle: this._latLabelStyle,\n      intervals: this.intervals,\n    })\n  },\n  /**\n   * @return {Promise} Resolves when initialization completes\n   * @protected\n   */\n  init () {\n    return this::olCmp.methods.init()\n  },\n  /**\n   * @return {void|Promise<void>}\n   * @protected\n   */\n  deinit () {\n    return this::olCmp.methods.deinit()\n  },\n  /**\n   * @return {void}\n   * @protected\n   */\n  mount () {\n    this.$map && this.$graticule.setMap(this.$map)\n    this.subscribeAll()\n  },\n  /**\n   * @return {void}\n   * @protected\n   */\n  unmount () {\n    this.unsubscribeAll()\n    this.$graticule.setMap(undefined)\n  },\n  getMeridians () {\n    hasGraticule(this)\n\n    return this.$graticule.getMeridians()\n  },\n  getParallels () {\n    hasGraticule(this)\n\n    return this.$graticule.getParallels()\n  },\n  setStroke (stroke) {\n    stroke = stroke instanceof Vue ? stroke.$style : stroke\n\n    if (stroke !== this._strokeStyle) {\n      this._strokeStyle = stroke\n      this.scheduleRefresh()\n    }\n  },\n  setText (text) {\n    text = text instanceof Vue ? text.$style : text\n\n    let vm\n    if (text) {\n      vm = firstEl(text[this.$options.VM_PROP])\n    }\n\n    const vmMatcher = vnode => vnode.componentInstance && vnode.componentInstance === vm\n\n    if (\n      (text == null && this.$slots.lon == null) ||\n      (Array.isArray(this.$slots.lon) && this.$slots.lon.some(vmMatcher))\n    ) {\n      if (text !== this._lonLabelStyle) {\n        this._lonLabelStyle = text\n        this.scheduleRefresh()\n      }\n    } else if (\n      (text == null && this.$slots.lat == null) ||\n      (Array.isArray(this.$slots.lat) && this.$slots.lat.some(vmMatcher))\n    ) {\n      if (text !== this._latLabelStyle) {\n        this._latLabelStyle = text\n        this.scheduleRefresh()\n      }\n    }\n  },\n  getServices () {\n    const vm = this\n\n    return mergeDescriptors(this::olCmp.methods.getServices(), {\n      get stylesContainer () { return vm },\n    })\n  },\n  /**\n   * @return {Promise}\n   */\n  refresh () {\n    return this.recreate()\n  },\n  subscribeAll () {\n    hasMap(this)\n\n    const ft = 1000 / 60\n    const postcompose = observableFromOlEvent(this.$map, 'postcompose')\n      .pipe(throttleTime(ft))\n\n    this.subscribeTo(postcompose, () => {\n      ++this.rev\n    })\n  },\n}\n\nconst watch = makeWatchers(Object.keys(props), () => function () {\n  this.scheduleRefresh()\n})\n\nexport default {\n  name: 'vl-graticule',\n  mixins: [olCmp, useMapCmp, projTransforms],\n  props,\n  computed,\n  methods,\n  watch,\n  stubVNode: {\n    empty: false,\n    attrs () {\n      return {\n        class: this.$options.name,\n      }\n    },\n  },\n  created () {\n    Object.defineProperties(this, {\n      $graticule: {\n        enumerable: true,\n        get: () => this.$olObject,\n      },\n      $map: {\n        enumerable: true,\n        get: () => this.$services && this.$services.map,\n      },\n      $view: {\n        enumerable: true,\n        get: () => this.$services && this.$services.view,\n      },\n    })\n  },\n}\n","<template>\n  <i :class=\"$options.name\" style=\"display: none !important;\">\n    <slot name=\"lon\"></slot>\n    <slot name=\"lat\"></slot>\n    <slot name=\"stroke\"></slot>\n  </i>\n</template>\n\n<script>\n  import Vue from 'vue'\n  import Graticule from 'ol/Graticule'\n  import { throttleTime } from 'rxjs/operators'\n  import { observableFromOlEvent } from '../../rx-ext'\n  import { olCmp, useMapCmp, projTransforms } from '../../mixin'\n  import { hasGraticule, hasMap } from '../../util/assert'\n  import { firstEl, map } from '../../util/minilo'\n  import mergeDescriptors from '../../util/multi-merge-descriptors'\n  import { makeWatchers } from '../../util/vue-helpers'\n\n  const props = {\n    maxLines: {\n      type: Number,\n      default: 100,\n    },\n    targetSize: {\n      type: Number,\n      default: 100,\n    },\n    showLabels: {\n      type: Boolean,\n      default: false,\n    },\n    lonLabelFormatter: Function,\n    latLabelFormatter: Function,\n    lonLabelPosition: {\n      type: Number,\n      default: 0,\n    },\n    latLabelPosition: {\n      type: Number,\n      default: 1,\n    },\n    intervals: {\n      type: Array,\n      default: () => [90, 45, 30, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1, 0.05, 0.01, 0.005, 0.002, 0.001],\n    },\n  }\n\n  const computed = {\n    meridians () {\n      if (this.$graticule && this.rev) {\n        return map(this.getMeridians(), meridian => this.lineToDataProj(meridian.getCoordinates()))\n      }\n\n      return []\n    },\n    parallels () {\n      if (this.$graticule && this.rev) {\n        return map(this.getParallels(), parallel => this.lineToDataProj(parallel.getCoordinates()))\n      }\n\n      return []\n    },\n  }\n\n  const methods = {\n    createOlObject () {\n      return new Graticule({\n        maxLines: this.maxLines,\n        targetSize: this.targetSize,\n        showLabels: this.showLabels,\n        strokeStyle: this._strokeStyle,\n        lonLabelFormatter: this.lonLabelFormatter,\n        latLabelFormatter: this.latLabelFormatter,\n        lonLabelPosition: this.lonLabelPosition,\n        latLabelPosition: this.latLabelPosition,\n        lonLabelStyle: this._lonLabelStyle,\n        latLabelStyle: this._latLabelStyle,\n        intervals: this.intervals,\n      })\n    },\n    /**\n     * @return {Promise} Resolves when initialization completes\n     * @protected\n     */\n    init () {\n      return this::olCmp.methods.init()\n    },\n    /**\n     * @return {void|Promise<void>}\n     * @protected\n     */\n    deinit () {\n      return this::olCmp.methods.deinit()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    mount () {\n      this.$map && this.$graticule.setMap(this.$map)\n      this.subscribeAll()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    unmount () {\n      this.unsubscribeAll()\n      this.$graticule.setMap(undefined)\n    },\n    getMeridians () {\n      hasGraticule(this)\n\n      return this.$graticule.getMeridians()\n    },\n    getParallels () {\n      hasGraticule(this)\n\n      return this.$graticule.getParallels()\n    },\n    setStroke (stroke) {\n      stroke = stroke instanceof Vue ? stroke.$style : stroke\n\n      if (stroke !== this._strokeStyle) {\n        this._strokeStyle = stroke\n        this.scheduleRefresh()\n      }\n    },\n    setText (text) {\n      text = text instanceof Vue ? text.$style : text\n\n      let vm\n      if (text) {\n        vm = firstEl(text[this.$options.VM_PROP])\n      }\n\n      const vmMatcher = vnode => vnode.componentInstance && vnode.componentInstance === vm\n\n      if (\n        (text == null && this.$slots.lon == null) ||\n        (Array.isArray(this.$slots.lon) && this.$slots.lon.some(vmMatcher))\n      ) {\n        if (text !== this._lonLabelStyle) {\n          this._lonLabelStyle = text\n          this.scheduleRefresh()\n        }\n      } else if (\n        (text == null && this.$slots.lat == null) ||\n        (Array.isArray(this.$slots.lat) && this.$slots.lat.some(vmMatcher))\n      ) {\n        if (text !== this._latLabelStyle) {\n          this._latLabelStyle = text\n          this.scheduleRefresh()\n        }\n      }\n    },\n    getServices () {\n      const vm = this\n\n      return mergeDescriptors(this::olCmp.methods.getServices(), {\n        get stylesContainer () { return vm },\n      })\n    },\n    /**\n     * @return {Promise}\n     */\n    refresh () {\n      return this.recreate()\n    },\n    subscribeAll () {\n      hasMap(this)\n\n      const ft = 1000 / 60\n      const postcompose = observableFromOlEvent(this.$map, 'postcompose')\n        .pipe(throttleTime(ft))\n\n      this.subscribeTo(postcompose, () => {\n        ++this.rev\n      })\n    },\n  }\n\n  const watch = makeWatchers(Object.keys(props), () => function () {\n    this.scheduleRefresh()\n  })\n\n  export default {\n    name: 'vl-graticule',\n    mixins: [olCmp, useMapCmp, projTransforms],\n    props,\n    computed,\n    methods,\n    watch,\n    stubVNode: {\n      empty: false,\n      attrs () {\n        return {\n          class: this.$options.name,\n        }\n      },\n    },\n    created () {\n      Object.defineProperties(this, {\n        $graticule: {\n          enumerable: true,\n          get: () => this.$olObject,\n        },\n        $map: {\n          enumerable: true,\n          get: () => this.$services && this.$services.map,\n        },\n        $view: {\n          enumerable: true,\n          get: () => this.$services && this.$services.view,\n        },\n      })\n    },\n  }\n</script>\n","import { pick } from '../../util/minilo'\nimport Graticule from './graticule.vue'\n\nfunction plugin (Vue, options = {}) {\n  if (plugin.installed) {\n    return\n  }\n  plugin.installed = true\n\n  options = pick(options, 'dataProjection')\n  Object.assign(Graticule, options)\n\n  Vue.component(Graticule.name, Graticule)\n}\n\nexport default plugin\n\nexport {\n  Graticule,\n  plugin as install,\n}\n"],"names":["props","maxLines","type","Number","default","targetSize","showLabels","Boolean","lonLabelFormatter","Function","latLabelFormatter","lonLabelPosition","latLabelPosition","intervals","Array","computed","meridians","$graticule","rev","map","getMeridians","meridian","lineToDataProj","getCoordinates","parallels","getParallels","parallel","methods","createOlObject","Graticule","strokeStyle","_strokeStyle","lonLabelStyle","_lonLabelStyle","latLabelStyle","_latLabelStyle","init","olCmp","deinit","mount","$map","setMap","subscribeAll","unmount","unsubscribeAll","undefined","hasGraticule","setStroke","stroke","Vue","$style","scheduleRefresh","setText","text","vm","firstEl","$options","VM_PROP","vmMatcher","vnode","componentInstance","$slots","lon","some","lat","getServices","mergeDescriptors","stylesContainer","refresh","recreate","hasMap","ft","postcompose","observableFromOlEvent","pipe","throttleTime","subscribeTo","watch","makeWatchers","name","mixins","useMapCmp","projTransforms","stubVNode","empty","attrs","class","created","enumerable","get","$olObject","$services","$view","view","plugin","options","installed","pick","component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAmBA,IAAMA,KAAK,GAAG;EACZC,QAAQ,EAAE;IACRC,IAAI,EAAEC,MADE;IAERC,OAAO,EAAE;GAHC;EAKZC,UAAU,EAAE;IACVH,IAAI,EAAEC,MADI;IAEVC,OAAO,EAAE;GAPC;EASZE,UAAU,EAAE;IACVJ,IAAI,EAAEK,OADI;IAEVH,OAAO,EAAE;GAXC;EAaZI,iBAAiB,EAAEC,QAbP;EAcZC,iBAAiB,EAAED,QAdP;EAeZE,gBAAgB,EAAE;IAChBT,IAAI,EAAEC,MADU;IAEhBC,OAAO,EAAE;GAjBC;EAmBZQ,gBAAgB,EAAE;IAChBV,IAAI,EAAEC,MADU;IAEhBC,OAAO,EAAE;GArBC;EAuBZS,SAAS,EAAE;IACTX,IAAI,EAAEY,KADG;IAETV,OAAO,EAAE;aAAM,CAAC,EAAD,EAAK,EAAL,EAAS,EAAT,EAAa,EAAb,EAAiB,EAAjB,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,CAA3B,EAA8B,GAA9B,EAAmC,GAAnC,EAAwC,GAAxC,EAA6C,IAA7C,EAAmD,IAAnD,EAAyD,KAAzD,EAAgE,KAAhE,EAAuE,KAAvE,CAAN;;;CAzBb;AA6BA,IAAMW,QAAQ,GAAG;EACfC,SADe,uBACF;;;QACP,KAAKC,UAAL,IAAmB,KAAKC,GAA5B,EAAiC;aACxBC,GAAG,CAAC,KAAKC,YAAL,EAAD,EAAsB,UAAAC,QAAQ;eAAI,KAAI,CAACC,cAAL,CAAoBD,QAAQ,CAACE,cAAT,EAApB,CAAJ;OAA9B,CAAV;;;WAGK,EAAP;GANa;EAQfC,SARe,uBAQF;;;QACP,KAAKP,UAAL,IAAmB,KAAKC,GAA5B,EAAiC;aACxBC,GAAG,CAAC,KAAKM,YAAL,EAAD,EAAsB,UAAAC,QAAQ;eAAI,MAAI,CAACJ,cAAL,CAAoBI,QAAQ,CAACH,cAAT,EAApB,CAAJ;OAA9B,CAAV;;;WAGK,EAAP;;CAbJ;AAiBA,IAAMI,OAAO,GAAG;EACdC,cADc,4BACI;WACT,IAAIC,SAAJ,CAAc;MACnB5B,QAAQ,EAAE,KAAKA,QADI;MAEnBI,UAAU,EAAE,KAAKA,UAFE;MAGnBC,UAAU,EAAE,KAAKA,UAHE;MAInBwB,WAAW,EAAE,KAAKC,YAJC;MAKnBvB,iBAAiB,EAAE,KAAKA,iBALL;MAMnBE,iBAAiB,EAAE,KAAKA,iBANL;MAOnBC,gBAAgB,EAAE,KAAKA,gBAPJ;MAQnBC,gBAAgB,EAAE,KAAKA,gBARJ;MASnBoB,aAAa,EAAE,KAAKC,cATD;MAUnBC,aAAa,EAAE,KAAKC,cAVD;MAWnBtB,SAAS,EAAE,KAAKA;KAXX,CAAP;GAFY;;;;;;EAoBduB,IApBc,kBAoBN;WACOC,KAAK,CAACV,OAAN,CAAcS,IAApB,WAAP;GArBY;;;;;;EA2BdE,MA3Bc,oBA2BJ;WACKD,KAAK,CAACV,OAAN,CAAcW,MAApB,WAAP;GA5BY;;;;;;EAkCdC,KAlCc,mBAkCL;SACFC,IAAL,IAAa,KAAKvB,UAAL,CAAgBwB,MAAhB,CAAuB,KAAKD,IAA5B,CAAb;SACKE,YAAL;GApCY;;;;;;EA0CdC,OA1Cc,qBA0CH;SACJC,cAAL;SACK3B,UAAL,CAAgBwB,MAAhB,CAAuBI,SAAvB;GA5CY;EA8CdzB,YA9Cc,0BA8CE;IACd0B,YAAY,CAAC,IAAD,CAAZ;WAEO,KAAK7B,UAAL,CAAgBG,YAAhB,EAAP;GAjDY;EAmDdK,YAnDc,0BAmDE;IACdqB,YAAY,CAAC,IAAD,CAAZ;WAEO,KAAK7B,UAAL,CAAgBQ,YAAhB,EAAP;GAtDY;EAwDdsB,SAxDc,qBAwDHC,MAxDG,EAwDK;IACjBA,MAAM,GAAGA,MAAM,YAAYC,GAAlB,GAAwBD,MAAM,CAACE,MAA/B,GAAwCF,MAAjD;;QAEIA,MAAM,KAAK,KAAKjB,YAApB,EAAkC;WAC3BA,YAAL,GAAoBiB,MAApB;WACKG,eAAL;;GA7DU;EAgEdC,OAhEc,mBAgELC,IAhEK,EAgEC;IACbA,IAAI,GAAGA,IAAI,YAAYJ,GAAhB,GAAsBI,IAAI,CAACH,MAA3B,GAAoCG,IAA3C;QAEIC,EAAJ;;QACID,IAAJ,EAAU;MACRC,EAAE,GAAGC,OAAO,CAACF,IAAI,CAAC,KAAKG,QAAL,CAAcC,OAAf,CAAL,CAAZ;;;QAGIC,SAAS,GAAG,SAAZA,SAAY,CAAAC,KAAK;aAAIA,KAAK,CAACC,iBAAN,IAA2BD,KAAK,CAACC,iBAAN,KAA4BN,EAA3D;KAAvB;;QAGGD,IAAI,IAAI,IAAR,IAAgB,KAAKQ,MAAL,CAAYC,GAAZ,IAAmB,IAApC,IACC,eAAc,KAAKD,MAAL,CAAYC,GAA1B,KAAkC,KAAKD,MAAL,CAAYC,GAAZ,CAAgBC,IAAhB,CAAqBL,SAArB,CAFrC,EAGE;UACIL,IAAI,KAAK,KAAKpB,cAAlB,EAAkC;aAC3BA,cAAL,GAAsBoB,IAAtB;aACKF,eAAL;;KANJ,MAQO,IACJE,IAAI,IAAI,IAAR,IAAgB,KAAKQ,MAAL,CAAYG,GAAZ,IAAmB,IAApC,IACC,eAAc,KAAKH,MAAL,CAAYG,GAA1B,KAAkC,KAAKH,MAAL,CAAYG,GAAZ,CAAgBD,IAAhB,CAAqBL,SAArB,CAF9B,EAGL;UACIL,IAAI,KAAK,KAAKlB,cAAlB,EAAkC;aAC3BA,cAAL,GAAsBkB,IAAtB;aACKF,eAAL;;;GAxFQ;EA4Fdc,WA5Fc,yBA4FC;QACPX,EAAE,GAAG,IAAX;WAEOY,gBAAgB,CAAO7B,KAAK,CAACV,OAAN,CAAcsC,WAApB,WAAD,EAAoC;UACrDE,eAAJ,GAAuB;eAASb,EAAP;;;KADJ,CAAvB;GA/FY;;;;;EAsGdc,OAtGc,qBAsGH;WACF,KAAKC,QAAL,EAAP;GAvGY;EAyGd3B,YAzGc,0BAyGE;;;IACd4B,MAAM,CAAC,IAAD,CAAN;QAEMC,EAAE,GAAG,OAAO,EAAlB;QACMC,WAAW,GAAGC,qBAAqB,CAAC,KAAKjC,IAAN,EAAY,aAAZ,CAArB,CACjBkC,IADiB,CACZC,YAAY,CAACJ,EAAD,CADA,CAApB;SAGKK,WAAL,CAAiBJ,WAAjB,EAA8B,YAAM;QAChC,MAAI,CAACtD,GAAP;KADF;;CAhHJ;AAsHA,IAAM2D,KAAK,GAAGC,YAAY,CAAC,aAAY9E,KAAZ,CAAD,EAAqB;SAAM,YAAY;SAC1DmD,eAAL;GAD6C;CAArB,CAA1B;AAIA,aAAe;EACb4B,IAAI,EAAE,cADO;EAEbC,MAAM,EAAE,CAAC3C,KAAD,EAAQ4C,SAAR,EAAmBC,cAAnB,CAFK;EAGblF,KAAK,EAALA,KAHa;EAIbe,QAAQ,EAARA,QAJa;EAKbY,OAAO,EAAPA,OALa;EAMbkD,KAAK,EAALA,KANa;EAObM,SAAS,EAAE;IACTC,KAAK,EAAE,KADE;IAETC,KAFS,mBAEA;aACA;QACLC,KAAK,EAAE,KAAK9B,QAAL,CAAcuB;OADvB;;GAVS;EAebQ,OAfa,qBAeF;;;6BACe,IAAxB,EAA8B;MAC5BtE,UAAU,EAAE;QACVuE,UAAU,EAAE,IADF;QAEVC,GAAG,EAAE;iBAAM,MAAI,CAACC,SAAX;;OAHqB;MAK5BlD,IAAI,EAAE;QACJgD,UAAU,EAAE,IADR;QAEJC,GAAG,EAAE;iBAAM,MAAI,CAACE,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAexE,GAAvC;;OAPqB;MAS5ByE,KAAK,EAAE;QACLJ,UAAU,EAAE,IADP;QAELC,GAAG,EAAE;iBAAM,MAAI,CAACE,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeE,IAAvC;;;KAXT;;CAhBJ;;;ACxLY,2BAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAZ,SAASC,MAAT,CAAiB7C,MAAjB,EAAoC;MAAd8C,OAAc,uEAAJ,EAAI;;MAC9BD,MAAM,CAACE,SAAX,EAAsB;;;;EAGtBF,MAAM,CAACE,SAAP,GAAmB,IAAnB;EAEAD,OAAO,GAAGE,IAAI,CAACF,OAAD,EAAU,gBAAV,CAAd;;iBACclE,WAAd,EAAyBkE,OAAzB;;EAEA9C,MAAG,CAACiD,SAAJ,CAAcrE,WAAS,CAACkD,IAAxB,EAA8BlD,WAA9B;;;;;;"}