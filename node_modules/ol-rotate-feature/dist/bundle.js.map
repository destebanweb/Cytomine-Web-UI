{"version":3,"file":"bundle.js","sources":["../src/util.js","../src/event.js","../src/shim.js","../src/interaction.js","../src/index.js"],"sourcesContent":["/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n\n/**\n * @param {boolean} condition\n * @param {string} message\n * @throws Error\n */\nexport function assert (condition, message = '') {\n  message = [ 'Assertion failed', message ].join(': ')\n\n  if (!condition) {\n    throw new Error(message)\n  }\n}\n\n/**\n * @param {*} arg\n * @returns {*}\n */\nexport function identity (arg) {\n  return arg\n}\n\n/**\n * @param {...*} args\n * @return {*}\n */\nexport function coalesce (...args) {\n  return args.filter(value => value != null).shift()\n}\n\nconst counters = {}\n/**\n * @param {string} [prefix]\n * @return {number}\n */\nexport function uniqId (prefix = '') {\n  const ns = prefix || 'default'\n  counters[ ns ] = counters[ ns ] == null ? 0 : counters[ ns ]\n\n  return String(prefix) + (++counters[ ns ])\n}\n\nexport function includes (arr, value) {\n  return arr.indexOf(value) !== -1\n}\n\nexport function isArray (val) {\n  return val::Object.prototype.toString() === '[object Array]'\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n/**\n * @enum {string}\n */\nexport const RotateFeatureEventType = {\n  /**\n   * Triggered upon feature rotate start.\n   * @event RotateFeatureEvent#rotatestart\n   */\n  START: 'rotatestart',\n  /**\n   * Triggered upon feature rotation.\n   * @event RotateFeatureEvent#rotating\n   */\n  ROTATING: 'rotating',\n  /**\n   * Triggered upon feature rotation end.\n   * @event RotateFeatureEvent#rotateend\n   */\n  END: 'rotateend'\n}\n\n/**\n * Events emitted by RotateFeatureInteraction instances are instances of this type.\n *\n * @class\n * @author Vladimir Vershinin\n */\nexport default class RotateFeatureEvent {\n  /**\n   * @param {string} type Type.\n   * @param {ol.Collection<ol.Feature>} features Rotated features.\n   * @param {number} angle Angle in radians.\n   * @param {ol.Coordinate} anchor Anchor position.\n   */\n  constructor (type, features, angle, anchor) {\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.propagationStopped_ = false\n\n    /**\n     * The event type.\n     * @type {string}\n     * @private\n     */\n    this.type_ = type\n\n    /**\n     * The features being rotated.\n     * @type {ol.Collection<ol.Feature>}\n     * @private\n     */\n    this.features_ = features\n    /**\n     * Current angle in radians.\n     * @type {number}\n     * @private\n     */\n    this.angle_ = angle\n    /**\n     * Current rotation anchor.\n     * @type {ol.Coordinate}\n     * @private\n     */\n    this.anchor_ = anchor\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get propagationStopped () {\n    return this.propagationStopped_\n  }\n\n  /**\n   * @type {RotateFeatureEventType}\n   */\n  get type () {\n    return this.type_\n  }\n\n  /**\n   * @type {ol.Collection<ol.Feature>}\n   */\n  get features () {\n    return this.features_\n  }\n\n  /**\n   * @type {number}\n   */\n  get angle () {\n    return this.angle_\n  }\n\n  /**\n   * @type {ol.Coordinate}\n   */\n  get anchor () {\n    return this.anchor_\n  }\n\n  /**\n   * Prevent event propagation.\n   */\n  preventDefault () {\n    this.propagationStopped_ = true\n  }\n\n  /**\n   * Stop event propagation.\n   */\n  stopPropagation () {\n    this.propagationStopped_ = true\n  }\n}\n","const ua = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase() : ''\n\nexport const MAC = ua.indexOf('macintosh') !== -1\n\nexport const WEBKIT = ua.indexOf('webkit') !== -1 && ua.indexOf('edge') == -1\n\nexport const mouseActionButton = function (mapBrowserEvent) {\n  const originalEvent = /** @type {MouseEvent} */ (mapBrowserEvent.originalEvent)\n  return originalEvent.button == 0 && !(WEBKIT && MAC && originalEvent.ctrlKey)\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n/**\n * Rotate interaction class.\n * Adds controls to rotate vector features.\n * Writes out total angle in radians (positive is counter-clockwise) to property for each feature.\n */\nimport PointerInteraction from 'ol/interaction/Pointer'\nimport Collection from 'ol/Collection'\nimport VectorLayer from 'ol/layer/Vector'\nimport VectorSource from 'ol/source/Vector'\nimport Feature from 'ol/Feature'\nimport Point from 'ol/geom/Point'\nimport Polygon from 'ol/geom/Polygon'\nimport GeometryCollection from 'ol/geom/GeometryCollection'\nimport Style from 'ol/style/Style'\nimport RegularShape from 'ol/style/RegularShape'\nimport Stroke from 'ol/style/Stroke'\nimport Fill from 'ol/style/Fill'\nimport Text from 'ol/style/Text'\nimport {getCenter as getExtentCenter} from 'ol/extent'\nimport { always, mouseOnly } from 'ol/events/condition';\nimport { assert, identity, includes, isArray } from './util'\nimport RotateFeatureEvent, { RotateFeatureEventType } from './event'\nimport { mouseActionButton } from './shim'\n\nconst ANCHOR_KEY = 'rotate-anchor'\nconst ARROW_KEY = 'rotate-arrow'\n\nconst ANGLE_PROP = 'angle'\nconst ANCHOR_PROP = 'anchor'\n\n/**\n * @todo todo добавить опцию condition - для возможности переопределения клавиш\n */\nexport default class RotateFeatureInteraction extends PointerInteraction {\n  /**\n   * @param {InteractionOptions} options\n   */\n  constructor (options = {}) {\n    super({\n      // handleEvent: handleEvent,\n      handleDownEvent,\n      handleUpEvent,\n      handleDragEvent,\n      handleMoveEvent\n    })\n    /**\n     * @type {string}\n     * @private\n     */\n    this.previousCursor_ = undefined\n    /**\n     * @type {Feature}\n     * @private\n     */\n    this.anchorFeature_ = undefined\n    /**\n     * @type {Feature}\n     * @private\n     */\n    this.arrowFeature_ = undefined\n    /**\n     * @type {Coordinate}\n     * @private\n     */\n    this.lastCoordinate_ = undefined\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.anchorMoving_ = false\n    /**\n     * @type {Vector}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      style: options.style || getDefaultStyle(),\n      source: new VectorSource({\n        features: new Collection()\n      })\n    })\n    /**\n     * @private\n     * @type {module:ol/events/condition~Condition}\n     */\n    this.condition_ = options.condition ? options.condition : always;\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.features_ = undefined\n    if (options.features) {\n      if (isArray(options.features)) {\n        this.features_ = new Collection(options.features)\n      } else if (options.features instanceof Collection) {\n        this.features_ = options.features\n      } else {\n        throw new Error('Features option should be an array or collection of features, ' +\n                        'got ' + (typeof options.features))\n      }\n    } else {\n      this.features_ = new Collection()\n    }\n\n    /**\n     * @type {boolean}\n     * @public\n     */\n    this.allowAnchorMovement = options.allowAnchorMovement === undefined ? true : options.allowAnchorMovement;\n\n    this.setAnchor(options.anchor || getFeaturesCentroid(this.features_))\n    this.setAngle(options.angle || 0)\n\n    this.features_.on('add', ::this.onFeatureAdd_)\n    this.features_.on('remove', ::this.onFeatureRemove_)\n    this.on('change:' + ANGLE_PROP, ::this.onAngleChange_)\n    this.on('change:' + ANCHOR_PROP, ::this.onAnchorChange_)\n\n    this.createOrUpdateAnchorFeature_()\n    this.createOrUpdateArrowFeature_()\n  }\n\n  /**\n   * @type {Collection<Feature>}\n   */\n  get features () {\n    return this.features_\n  }\n\n  /**\n   * @type {number}\n   */\n  get angle () {\n    return this.getAngle()\n  }\n\n  /**\n   * @param {number} angle\n   */\n  set angle (angle) {\n    this.setAngle(angle)\n  }\n\n  /**\n   * @type {Coordinate|number[]|undefined}\n   */\n  get anchor () {\n    return this.getAnchor()\n  }\n\n  /**\n   * @param {Coordinate|undefined} anchor\n   */\n  set anchor (anchor) {\n    this.setAnchor(anchor)\n  }\n\n  /**\n   * @param {PluggableMap} map\n   */\n  set map (map) {\n    this.setMap(map)\n  }\n\n  /**\n   * @type {PluggableMap}\n   */\n  get map() {\n    return this.getMap()\n  }\n\n  /**\n   * @param {boolean} active\n   */\n  set active (active) {\n    this.setActive(active)\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get active () {\n    return this.getActive()\n  }\n\n  /**\n   * @param {ol.Map} map\n   */\n  setMap (map) {\n    this.overlay_.setMap(map)\n    super.setMap(map)\n  }\n\n  /**\n   * @param {boolean} active\n   */\n  setActive (active) {\n    if (this.overlay_) {\n      this.overlay_.setMap(active ? this.map : undefined)\n    }\n\n    super.setActive(active)\n  }\n\n  /**\n   * Set current angle of interaction features.\n   *\n   * @param {number} angle\n   */\n  setAngle (angle) {\n    assert(!isNaN(parseFloat(angle)), 'Numeric value passed')\n\n    this.set(ANGLE_PROP, parseFloat(angle))\n  }\n\n  /**\n   * Returns current angle of interaction features.\n   *\n   * @return {number}\n   */\n  getAngle () {\n    return this.get(ANGLE_PROP)\n  }\n\n  /**\n   * Set current anchor position.\n   *\n   * @param {Coordinate | undefined} anchor\n   */\n  setAnchor (anchor) {\n    assert(anchor == null || isArray(anchor) && anchor.length === 2, 'Array of two elements passed')\n\n    this.set(ANCHOR_PROP, anchor != null ? anchor.map(parseFloat) : getFeaturesCentroid(this.features_))\n  }\n\n  /**\n   * Returns current anchor position.\n   *\n   * @return {Coordinate | undefined}\n   */\n  getAnchor () {\n    return this.get(ANCHOR_PROP)\n  }\n\n  /**\n   * @private\n   */\n  createOrUpdateAnchorFeature_ () {\n    const angle = this.getAngle()\n    const anchor = this.getAnchor()\n\n    if (!anchor) return\n\n    if (this.anchorFeature_) {\n      this.anchorFeature_.getGeometry().setCoordinates(anchor)\n      this.anchorFeature_.set(ANGLE_PROP, angle)\n    } else {\n      this.anchorFeature_ = new Feature({\n        geometry: new Point(anchor),\n        [ ANGLE_PROP ]: angle,\n        [ ANCHOR_KEY ]: true\n      })\n      this.overlay_.getSource().addFeature(this.anchorFeature_)\n    }\n  }\n\n  /**\n   * @private\n   */\n  createOrUpdateArrowFeature_ () {\n    const angle = this.getAngle()\n    const anchor = this.getAnchor()\n\n    if (!anchor) return\n\n    if (this.arrowFeature_) {\n      this.arrowFeature_.getGeometry().setCoordinates(anchor)\n      this.arrowFeature_.set(ANGLE_PROP, angle)\n    } else {\n      this.arrowFeature_ = new Feature({\n        geometry: new Point(anchor),\n        [ ANGLE_PROP ]: angle,\n        [ ARROW_KEY ]: true\n      })\n      this.overlay_.getSource().addFeature(this.arrowFeature_)\n    }\n  }\n\n  /**\n   * @private\n   */\n  resetAngleAndAnchor_() {\n    this.resetAngle_();\n    this.resetAnchor_();\n  }\n\n  /**\n   * @private\n   */\n  resetAngle_() {\n    this.set(ANGLE_PROP, 0, true);\n    this.arrowFeature_ && this.arrowFeature_.set(ANGLE_PROP, this.getAngle());\n    this.anchorFeature_ && this.anchorFeature_.set(ANGLE_PROP, this.getAngle());\n  }\n\n  /**\n   * @private\n   */\n  resetAnchor_() {\n    this.set(ANCHOR_PROP, getFeaturesCentroid(this.features_), true);\n\n    if (this.getAnchor()) {\n      this.arrowFeature_ && this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor());\n      this.anchorFeature_ && this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor());\n    }\n  }\n\n  /**\n   * @private\n   */\n  onFeatureAdd_ () {\n    this.resetAngleAndAnchor_()\n    this.createOrUpdateAnchorFeature_()\n    this.createOrUpdateArrowFeature_()\n  }\n\n  /**\n   * @private\n   */\n  onFeatureRemove_ () {\n    this.resetAngleAndAnchor_()\n\n    if (this.features_.getLength()) {\n      this.createOrUpdateAnchorFeature_()\n      this.createOrUpdateArrowFeature_()\n    } else {\n      this.overlay_.getSource().clear()\n      this.anchorFeature_ = this.arrowFeature_ = undefined\n    }\n  }\n\n  /**\n   * @private\n   */\n  onAngleChange_({ oldValue }) {\n    this.features_.forEach(feature => feature.getGeometry().rotate(this.getAngle() - oldValue, this.getAnchor()))\n    this.arrowFeature_ && this.arrowFeature_.set(ANGLE_PROP, this.getAngle())\n    this.anchorFeature_ && this.anchorFeature_.set(ANGLE_PROP, this.getAngle())\n  }\n\n  /**\n   * @private\n   */\n  onAnchorChange_() {\n    const anchor = this.getAnchor()\n\n    if (anchor) {\n      this.anchorFeature_ && this.anchorFeature_.getGeometry().setCoordinates(anchor)\n      this.arrowFeature_ && this.arrowFeature_.getGeometry().setCoordinates(anchor)\n    }\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotateStartEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.START,\n        features,\n        this.getAngle(),\n        this.getAnchor()\n      )\n    )\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotatingEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.ROTATING,\n        features,\n        this.getAngle(),\n        this.getAnchor()\n      )\n    )\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotateEndEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.END,\n        features,\n        this.getAngle(),\n        this.getAnchor()\n      )\n    )\n  }\n}\n\n/**\n * @param {MapBrowserEvent} evt Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {RotateFeatureInteraction}\n * @private\n */\n// function handleEvent (evt) {\n//   // disable selection of inner features\n//   const foundFeature = evt.map.forEachFeatureAtPixel(evt.pixel, identity)\n//   if (\n//     includes([ 'click', 'singleclick', 'dblclick' ], evt.type) &&\n//     includes([ this.anchorFeature_, this.arrowFeature_ ], foundFeature)\n//   ) {\n//     return false\n//   }\n//\n//   return this::baseHandleEvent(evt)\n// }\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleDownEvent (evt) {\n  if (!mouseOnly(evt)) {\n    return false;\n  }\n\n  if (mouseActionButton(evt) && this.condition_(evt)) {\n    // disable selection of inner features\n    const foundFeature = evt.map.forEachFeatureAtPixel(evt.pixel, identity)\n    if (\n      includes([ 'click', 'singleclick', 'dblclick' ], evt.type) &&\n      includes([ this.anchorFeature_, this.arrowFeature_ ], foundFeature)\n    ) {\n      return false\n    }\n    // handle click & drag on features for rotation\n    if (\n      foundFeature && !this.lastCoordinate_ &&\n      (\n        includes(this.features_.getArray(), foundFeature) ||\n        foundFeature === this.arrowFeature_\n      )\n    ) {\n      this.lastCoordinate_ = evt.coordinate\n\n      this::handleMoveEvent(evt)\n      this.dispatchRotateStartEvent_(this.features_)\n\n      return true\n    }\n    // handle click & drag on rotation anchor feature\n    else if (foundFeature && foundFeature === this.anchorFeature_ && this.allowAnchorMovement) {\n      this.anchorMoving_ = true\n      this::handleMoveEvent(evt)\n\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleUpEvent (evt) {\n  // stop drag sequence of features\n  if (this.lastCoordinate_) {\n    this.lastCoordinate_ = undefined\n\n    this::handleMoveEvent(evt)\n    this.dispatchRotateEndEvent_(this.features_)\n\n    return true\n  }\n  // stop drag sequence of the anchors\n  else if (this.anchorMoving_) {\n    this.anchorMoving_ = false\n    this::handleMoveEvent(evt)\n\n    return true\n  }\n\n  return false\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleDragEvent ({ coordinate }) {\n  const anchorCoordinate = this.anchorFeature_.getGeometry().getCoordinates()\n\n  // handle drag of features by angle\n  if (this.lastCoordinate_) {\n    // calculate vectors of last and current pointer positions\n    const lastVector = [\n      this.lastCoordinate_[ 0 ] - anchorCoordinate[ 0 ],\n      this.lastCoordinate_[ 1 ] - anchorCoordinate[ 1 ]\n    ]\n    const newVector = [\n      coordinate[ 0 ] - anchorCoordinate[ 0 ],\n      coordinate[ 1 ] - anchorCoordinate[ 1 ]\n    ]\n\n    // calculate angle between last and current vectors (positive angle counter-clockwise)\n    let angle = Math.atan2(\n      lastVector[ 0 ] * newVector[ 1 ] - newVector[ 0 ] * lastVector[ 1 ],\n      lastVector[ 0 ] * newVector[ 0 ] + lastVector[ 1 ] * newVector[ 1 ]\n    )\n\n    this.setAngle(this.getAngle() + angle)\n    this.dispatchRotatingEvent_(this.features_)\n\n    this.lastCoordinate_ = coordinate\n  }\n  // handle drag of the anchor\n  else if (this.anchorMoving_) {\n    this.setAnchor(coordinate)\n  }\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleMoveEvent ({ map, pixel }) {\n  const elem = map.getTargetElement()\n  const foundFeature = map.forEachFeatureAtPixel(pixel, identity)\n\n  const setCursor = (cursor, vendor = false) => {\n    if (vendor) {\n      elem.style.cursor = '-webkit-' + cursor\n      elem.style.cursor = '-moz-' + cursor\n    }\n\n    elem.style.cursor = cursor\n  }\n\n  if (this.lastCoordinate_) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('grabbing', true)\n  } else if (\n    foundFeature &&\n    (\n      includes(this.features_.getArray(), foundFeature) ||\n      foundFeature === this.arrowFeature_\n    )\n  ) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('grab', true)\n  } else if (( foundFeature && foundFeature === this.anchorFeature_ && this.allowAnchorMovement) || this.anchorMoving_) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('crosshair')\n  } else {\n    setCursor(this.previousCursor_ || '')\n    this.previousCursor_ = undefined\n  }\n}\n\n/**\n * @returns {StyleFunction}\n * @private\n */\nfunction getDefaultStyle () {\n  const white = [ 255, 255, 255, 0.8 ]\n  const blue = [ 0, 153, 255, 0.8 ]\n  const transparent = [ 255, 255, 255, 0.01 ]\n  const width = 2\n\n  const styles = {\n    [ ANCHOR_KEY ]: [\n      new Style({\n        image: new RegularShape({\n          fill: new Fill({\n            color: [ 0, 153, 255, 0.8 ]\n          }),\n          stroke: new Stroke({\n            color: blue,\n            width: 1\n          }),\n          radius: 4,\n          points: 6\n        }),\n        zIndex: Infinity\n      })\n    ],\n    [ ARROW_KEY ]: [\n      new Style({\n        fill: new Fill({\n          color: transparent\n        }),\n        stroke: new Stroke({\n          color: white,\n          width: width + 2\n        }),\n        text: new Text({\n          font: '12px sans-serif',\n          offsetX: 20,\n          offsetY: -20,\n          fill: new Fill({\n            color: 'blue'\n          }),\n          stroke: new Stroke({\n            color: white,\n            width: width + 1\n          })\n        }),\n        zIndex: Infinity\n      }),\n      new Style({\n        fill: new Fill({\n          color: transparent\n        }),\n        stroke: new Stroke({\n          color: blue,\n          width\n        }),\n        zIndex: Infinity\n      })\n    ]\n  }\n\n  return function (feature, resolution) {\n    let style\n    const angle = feature.get(ANGLE_PROP) || 0\n\n    switch (true) {\n      case feature.get(ANCHOR_KEY):\n        style = styles[ ANCHOR_KEY ]\n        style[ 0 ].getImage().setRotation(-angle)\n\n        return style\n      case feature.get(ARROW_KEY):\n        style = styles[ ARROW_KEY ]\n\n        const coordinates = feature.getGeometry().getCoordinates()\n        // generate arrow polygon\n        const geom = new Polygon([\n          [\n            [ coordinates[ 0 ], coordinates[ 1 ] - 6 * resolution ],\n            [ coordinates[ 0 ] + 8 * resolution, coordinates[ 1 ] - 12 * resolution ],\n            [ coordinates[ 0 ], coordinates[ 1 ] + 30 * resolution ],\n            [ coordinates[ 0 ] - 8 * resolution, coordinates[ 1 ] - 12 * resolution ],\n            [ coordinates[ 0 ], coordinates[ 1 ] - 6 * resolution ],\n          ]\n        ])\n\n        // and rotate it according to current angle\n        geom.rotate(angle, coordinates)\n        style[ 0 ].setGeometry(geom)\n        style[ 1 ].setGeometry(geom)\n        style[ 0 ].getText().setText(Math.round(-angle * 180 / Math.PI) + '°')\n\n        return style\n    }\n  }\n}\n\n/**\n * @param {Collection<Feature>|Array<Feature>} features\n * @returns {Extent | number[] | undefined}\n * @private\n */\nfunction getFeaturesExtent (features) {\n  features = features instanceof Collection ? features.getArray() : features\n  if (!features.length) return\n\n  return new GeometryCollection(features.map(feature => feature.getGeometry())).getExtent()\n}\n\n/**\n * @param {Collection<ol.Feature> | Array<Feature>} features\n * @return {Coordinate | number[] | undefined}\n */\nfunction getFeaturesCentroid (features) {\n  features = features instanceof Collection ? features.getArray() : features\n  if (!features.length) return\n\n  return getExtentCenter(getFeaturesExtent(features))\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport RotateFeatureInteraction from \"./interaction\"\n\n// for backward compatibility\nif (typeof window !== 'undefined' && window.ol) {\n  window.ol.interaction.RotateFeature = RotateFeatureInteraction\n}\n\nexport default RotateFeatureInteraction\n"],"names":["assert","condition","message","join","Error","identity","arg","includes","arr","value","indexOf","isArray","val","Object","prototype","toString","RotateFeatureEventType","START","ROTATING","END","RotateFeatureEvent","type","features","angle","anchor","propagationStopped_","type_","features_","angle_","anchor_","ua","navigator","userAgent","toLowerCase","MAC","WEBKIT","mouseActionButton","mapBrowserEvent","originalEvent","button","ctrlKey","ANCHOR_KEY","ARROW_KEY","ANGLE_PROP","ANCHOR_PROP","RotateFeatureInteraction","options","handleDownEvent","handleUpEvent","handleDragEvent","handleMoveEvent","previousCursor_","undefined","anchorFeature_","arrowFeature_","lastCoordinate_","anchorMoving_","overlay_","VectorLayer","style","getDefaultStyle","source","VectorSource","Collection","condition_","always","allowAnchorMovement","setAnchor","getFeaturesCentroid","setAngle","on","onFeatureAdd_","onFeatureRemove_","onAngleChange_","onAnchorChange_","createOrUpdateAnchorFeature_","createOrUpdateArrowFeature_","map","setMap","active","isNaN","parseFloat","set","get","length","getAngle","getAnchor","getGeometry","setCoordinates","Feature","geometry","Point","getSource","addFeature","resetAngle_","resetAnchor_","resetAngleAndAnchor_","getLength","clear","oldValue","forEach","feature","rotate","dispatchEvent","getMap","setActive","getActive","PointerInteraction","evt","mouseOnly","foundFeature","forEachFeatureAtPixel","pixel","getArray","coordinate","dispatchRotateStartEvent_","dispatchRotateEndEvent_","anchorCoordinate","getCoordinates","lastVector","newVector","Math","atan2","dispatchRotatingEvent_","elem","getTargetElement","setCursor","cursor","vendor","white","blue","transparent","width","styles","Style","image","RegularShape","fill","Fill","color","stroke","Stroke","radius","points","zIndex","Infinity","text","Text","font","offsetX","offsetY","resolution","getImage","setRotation","coordinates","geom","Polygon","setGeometry","getText","setText","round","PI","getFeaturesExtent","GeometryCollection","getExtent","getExtentCenter","window","ol","interaction","RotateFeature"],"mappings":"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"}